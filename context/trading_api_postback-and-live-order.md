# Documentation: Dhan HQ APIs

## 1. Postback API (Webhooks)

Postback API or Webhooks uses a `POST` request with **JSON payload** to the Postback URL. This JSON payload contains order update in case of change in status (`TRANSIT`, `PENDING`, `REJECTED`, `CANCELLED`, `TRADED` or `EXPIRED`) or whenever order is modified or partially filled.

This Postback API is on **access token** level i.e. all trades originating from one particular access token will be sent to that particular Webhook URL. This makes it optimal for individual developers.

### Postback Payload

The JSON payload is sent as a raw HTTP POST body in below structure.

**Structure**

```json
{
    "dhanClientId": "1000000003",
    "orderId": "112111182198",
    "correlationId":"123abc678",
    "orderStatus": "PENDING",
    "transactionType": "BUY",
    "exchangeSegment": "NSE_EQ",
    "productType": "INTRADAY",
    "orderType": "MARKET",
    "validity": "DAY",
    "tradingSymbol": "",
    "securityId": "11536",
    "quantity": 5,
    "disclosedQuantity": 0,
    "price": 0.0,
    "triggerPrice": 0.0,
    "afterMarketOrder": false,
    "boProfitValue": 0.0,
    "boStopLossValue": 0.0,
    "legName": null,
    "createTime": "2021-11-24 13:33:03",
    "updateTime": "2021-11-24 13:33:03",
    "exchangeTime": "2021-11-24 13:33:03",
    "drvExpiryDate": null,
    "drvOptionType": null,
    "drvStrikePrice": 0.0,
    "omsErrorCode": null,
    "omsErrorDescription": null,
    "filled_qty": 1,
    "algoId": null
}
```

**Parameters**

| Field | Type | Description |
|-------|------|-------------|
| dhanClientId | string | User specific identification generated by Dhan |
| orderId | string | Order specific identification generated by Dhan |
| correlationId | string | The user/partner generated id for tracking back |
| orderStatus | enum string | Last updated status of the order<br>`TRANSIT` `PENDING` `REJECTED` `CANCELLED` `TRADED` `EXPIRED` |
| transactionType | enum string | The trading side of transaction<br>`BUY` `SELL` |
| exchangeSegment | enum string | Exchange & Segment<br>`NSE_EQ` `NSE_FNO` `NSE_CURRENCY` `BSE_EQ` `MCX_COMM` |
| productType | enum string | Product type of trade<br>`CNC` `INTRADAY` `MARGIN` `MTF` `CO` `BO` |
| orderType | enum string | Order Type<br>`LIMIT` `MARKET` `STOP_LOSS` `STOP_LOSS_MARKET` |
| validity | enum string | Validity of Order<br>`DAY` `IOC` |
| tradingSymbol | string | Refer Trading Symbol in Tables |
| securityId | string | Exchange standard id for each scrip. Refer [here](https://dhanhq.co/docs/v2/instruments/) |
| quantity | int | Number of shares for the order |
| disclosedQuantity | int | Number of shares visible |
| price | float | Price at which order is placed |
| triggerPrice | float | Price at which order is triggered, for SL-M, SL-L, CO & BO |
| afterMarketOrder | boolean | The order placed is AMO ? |
| boProfitValue | float | Bracket Order Target Price change |
| boStopLossValue | float | Bracket Order Stop Loss Price change |
| legName | enum string | Leg identification in case of BO<br>`ENTRY_LEG` `TARGET_LEG` `STOP_LOSS_LEG` |
| createTime | string | Time at which the order is created |
| updateTime | string | Time at which the last activity happened |
| exchangeTime | string | Time at which order reached at exchange |
| drvExpiryDate | string | For F&O, expiry date of contract |
| drvOptionType | enum string | Type of Option<br>`CALL` `PUT` |
| drvStrikePrice | float | For Options, Strike Price |
| omsErrorCode | string | Error code in case the order is rejected or failed |
| omsErrorDescription | string | Description of error in case the order is rejected or failed |
| filled_qty | int | Quantity which has already been traded |
| algoId | string | Algo ID registered with the Exchange, in case of registered algos |

### Setting up Postback

To set up Postback API, you will need to provide a unique Postback URL to receive callbacks. You will need to follow the steps below to set up Postback URL:

- While generating access token on [web.dhan.co](https://web.dhan.co/), enter your URL in the 'Postback URL' field.
- Click on 'Generate' to successfully set Postback and generate a new token.

**Important:** You will not receive postback calls if Postback URL is set to `localhost` or `127.0.0.1`.

> **Note:** To receive Postback originating for all orders placed from a platform/app, [Partner Login](https://dhanhq.co/docs/v2/#for-partners) module needs to be used.

---

## 2. Order Update (WebSocket)

Realtime order updates of all your orders can be received directly via WebSocket in your system. Once you connect to the WebSocket and authorise, all order updates in your account will get reflected real time via the stream.

With this update stream, you can know about status, traded price, quantity and other details about your orders.

The messages sent over this WebSocket will be JSON.

### Establishing Connection

To establish connection with DhanHQ Live Order Update, you can connect to the below endpoint using WebSocket library.

```
wss://api-order-update.dhan.co
```

While establishing connection, you need to send Authorisation Message for connection.

#### For Individual

You can receive order updates for all orders placed via your account, irrespective of the platform via which it was placed.

**Authorisation message structure**

```json
{
    "LoginReq":{
        "MsgCode": 42,
        "ClientId":"1000000001",
        "Token":"JWT"
    },
    "UserType": "SELF"
}
```

**Parameters**

| Field | Type | Description |
|-------|------|-------------|
| LoginReq<br>_required_ | {}, string | JSON for adding Client ID and Access Token |
| MsgCode<br>_required_ | int | Message Code for getting Order Updates<br>`42` by default |
| ClientId<br>_required_ | string | User specific identification generated by Dhan |
| Token<br>_required_ | string | Access Token generated for user |
| UserType<br>_required_ | string | `SELF` for individual users |

#### For Partners

Platforms can receive order updates originating for all users connected to their platform/app for which [Partner Login](https://dhanhq.co/docs/v2/#for-partners) module needs to be used.

**Authorisation message structure**

```json
{
    "LoginReq":{
        "MsgCode": 42,
        "ClientId": "partner_id"
    },
    "UserType": "PARTNER",
    "Secret": "partner_secret"
}
```

**Parameters**

| Field | Type | Description |
|-------|------|-------------|
| LoginReq<br>_required_ | {}, string | JSON for adding Client ID and Access Token |
| MsgCode<br>_required_ | int | Message Code for getting Order Updates<br>`42` by default |
| ClientId<br>_required_ | string | `partner_id` generated for the partner |
| UserType<br>_required_ | string | `PARTNER` for partner platforms |
| Secret<br>_required_ | string | `partner_secret` generated for the partner |

### Order Update

Order Update messages are sent via WebSocket in below structure.

**Structure**

```json
{
    "Data": {
        "series": "EQ",
        "goodTillDaysDate": "2024-09-11",
        "instrumentType": "EQ",
        "refLtp": 13.21,
        "tickSize": 0.01,
        "algoId": "0",
        "multiplier": 1,
        "Exchange": "NSE",
        "Segment": "E",
        "Source": "N",
        "SecurityId": "14366",
        "ClientId": "1000000001",
        "ExchOrderNo": "1400000000404591",
        "OrderNo": "1124091136546",
        "Product": "C",
        "TxnType": "B",
        "OrderType": "LMT",
        "Validity": "DAY",
        "DiscQuantity": 1,
        "DiscQtyRem": 1,
        "RemainingQuantity": 1,
        "Quantity": 1,
        "TradedQty": 0,
        "Price": 13,
        "TriggerPrice": 0,
        "TradedPrice": 0,
        "AvgTradedPrice": 0,
        "AlgoOrdNo": null,
        "OffMktFlag": "0",
        "OrderDateTime": "2024-09-11 14:39:29",
        "ExchOrderTime": "2024-09-11 14:39:29",
        "LastUpdatedTime": "2024-09-11 14:39:29",
        "Remarks": "NR",
        "MktType": "NL",
        "ReasonDescription": "CONFIRMED",
        "LegNo": 1,
        "Instrument": "EQUITY",
        "Symbol": "IDEA",
        "ProductName": "CNC",
        "Status": "Cancelled",
        "LotSize": 1,
        "StrikePrice": null,
        "ExpiryDate": "0001-01-01 00:00:00",
        "OptType": "XX",
        "DisplayName": "Vodafone Idea",
        "Isin": "INE669E01016",
        "Series": "EQ",
        "GoodTillDaysDate": "2024-09-11",
        "RefLtp": 13.21,
        "TickSize": 0.01,
        "AlgoId": "0",
        "Multiplier": 1,
        "CorrelationId": "",
        "Remarks": "Super Order"
    },
    "Type": "order_alert"
}
```

**Parameters**

| Field | Type | Description |
|-------|------|-------------|
| Exchange | string | Exchange in which order is placed |
| Segment | string | Segment for which order is placed |
| Source | string | Platform via which order is placed - `P` for API Orders |
| SecurityId | string | Exchange standard ID for each scrip. Refer [here](https://dhanhq.co/docs/v2/instruments/) |
| ClientId | string | User specific identification generated by Dhan |
| ExchOrderNo | string | Order specific identification generated by Exchange |
| OrderNo | string | Order specific identification generated by Dhan |
| Product | enum string | Product type of trade<br>`C` for CNC, `I` for INTRADAY, `M` for MARGIN, `F` for MTF, `V` for CO, `B` for BO |
| TxnType | enum string | The trading side of transaction<br>`B` for Buy<br>`S` for Sell |
| OrderType | enum string | Order Type<br>`LMT` for Limit<br>`MKT` for Market<br>`SL` for Stop Loss<br>`SLM` for Stop Loss Market |
| Validity | enum string | Validity of Order<br>`DAY` `IOC` |
| DiscQuantity | int | Number of shares visible |
| DiscQtyRem | int | Disclosed quantity pending for execution |
| RemainingQuantity | int | Quantity pending for execution |
| Quantity | int | Total order quantity placed |
| TradedQty | int | Actual quantity executed on exchange |
| Price | float | Price at which order is placed |
| TriggerPrice | float | Price at which order is triggered, for SL-M, SL-L, CO & BO |
| TradedPrice | float | Price at which trade of an order is executed |
| AvgTradedPrice | float | Average trade price of an order (this will be different from `Traded Price` in case of partial execution) |
| AlgoOrdNo | float | Entry leg order number to track Target and Stop Loss leg (in case of `BO` and `CO`) |
| OffMktFlag | string | `1` in case of AMO order else `0` |
| OrderDateTime | string | Time at which the order is received by Dhan |
| ExchOrderTime | string | Time at which order is placed on Exchange |
| LastUpdatedTime | string | Last update time of any order modification or trade |
| Remarks | string | Additional remarks sent along while placing order |
| MktType | string | `NL` for Normal Market<br>`AU`, `A1` and `A2` for Auction Market |
| ReasonDescription | string | Order rejection reason |
| LegNo | int | `1` for Entry Leg<br>`2` for Stop Loss Leg<br>`3` for Target Leg |
| Instrument | string | Instrument in which order is placed - [here](https://dhanhq.co/docs/v2/annexure/#instrument) |
| Symbol | string | Symbol in which order is placed - Refer [here](https://dhanhq.co/docs/v2/instruments/) |
| ProductName | string | Product type of the order placed - [here](https://dhanhq.co/docs/v2/annexure/#product-type) |
| Status | enum string | Last updated status of the order<br>`TRANSIT` `PENDING` `REJECTED` `CANCELLED` `TRADED` `EXPIRED` |
| LotSize | int | Lot Size in case of Derivatives |
| StrikePrice | float | Strike Price in which order is placed in Option contract |
| ExpiryDate | string | Expiry Date of the contract in which order is placed |
| OptType | string | `CE` or `PE` in case of Option contract |
| DisplayName | string | Name of instrument in which order is placed - Refer [here](https://dhanhq.co/docs/v2/instruments/) |
| Isin | string | ISIN of the instrument in which order is placed |
| Series | string | Exchange series of the instrument |
| GoodTillDaysDate | string | Order validity in case of Forever Order |
| RefLtp | float | LTP at time of order update |
| TickSize | float | Tick size of the instrument |
| AlgoId | string | Exchange ID for special order types |
| Multiplier | int | In case of commodity and currency contracts |
| CorrelationId | string | The user/partner generated id for tracking back |
| Remarks | string | `Super Order` if the order is part of [super order](https://dhanhq.co/docs/v2/super-order) |

**Note:** For description of enum values, refer [Annexure](https://dhanhq.co/docs/v2/annexure)

---

[Source: Dhan HQ Postback Documentation](https://dhanhq.co/docs/v2/postback/)  
[Source: Dhan HQ Order Update Documentation](https://dhanhq.co/docs/v2/order-update/)